<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quest Board Chat</title>
    <%- include('partials/head-tags') %>
    <style>
      .chat-container {
        height: calc(
          100vh - 140px
        ); /* viewport height minus header/footer estimate */
        border: 1px solid #ddd;
        border-radius: 8px;
        overflow: hidden;
      }
      .threads {
        height: 100%;
        overflow-y: auto;
        border-right: 1px solid #ddd;
      }
      .chat-messages {
        height: 100%;
        display: flex;
        flex-direction: column;
      }
      .messages {
        flex: 1;
        overflow-y: auto;
        padding: 1rem;
        background: #f9f9f9;
      }
      .chat-input {
        border-top: 1px solid #ddd;
        padding: 0.5rem;
        background: #fff;
      }
      .chat-message {
        margin-bottom: 1rem;
        border-radius: 20px 20px 20px 0px;
        display: block;
        background: #ffffff;
        padding: 16px;
        border: 1px solid gray;
      }
      .blue-message{
        background-color: blue;
        color: #fff;
        border-radius: 20px 20px 0px 20px;
      }

      .chat-message .author {
        font-weight: bold;
      }
      .chat-message .time {
        font-size: 0.8rem;
        color: gray;
      }
      .chat-message .text {
        margin-top: 0.25rem;
      }
      .attachments img {
        max-width: 120px;
        margin-right: 0.5rem;
      }
    </style>
  </head>
  <body class="d-flex flex-column" style="height: 100%">
    <%- include('partials/header') %>

    <div class="container flex-grow-1 py-3">
      <div class="row chat-container">
        <!-- Sidebar for threads -->
        <div class="col-md-3 threads bg-light p-3">
          <h5>Threads</h5>
          <ul class="list-group">
            <li
              class="list-group-item d-flex justify-content-between align-items-center active"
            >
              General
              <span class="badge bg-primary rounded-pill">3</span>
            </li>
            <li
              class="list-group-item d-flex justify-content-between align-items-center"
            >
              Project X
              <span class="badge bg-secondary rounded-pill">1</span>
            </li>
            <li
              class="list-group-item d-flex justify-content-between align-items-center"
            >
              Support
              <span class="badge bg-success rounded-pill">5</span>
            </li>
          </ul>
        </div>

        <!-- Chat area -->
        <div class="col-md-9 chat-messages d-flex flex-column">
          <!-- Chat header -->
          <div
            class="d-flex justify-content-between align-items-center border-bottom p-2"
          >
            <h5 class="mb-0">#General</h5>
            <div>
              <button class="btn btn-sm btn-danger me-2">Delete Thread</button>
              <button class="btn btn-sm btn-success">Resolve Thread</button>
            </div>
          </div>

          <!-- Messages -->
          <div class="messages flex-grow-1 overflow-auto">
            <!-- Mock messages -->
            <div class="chat-message">
              <div class="author">Alice <span class="time">10:15 AM</span></div>
              <div class="text">
                Hey team! Here's the screenshot from yesterday's meeting.
              </div>
              <div class="attachments mt-1">
                <img
                  src="https://via.placeholder.com/120"
                  class="img-thumbnail"
                  alt="Attachment"
                />
              </div>
            </div>
            <div class="chat-message">
              <div class="author">Bob <span class="time">10:17 AM</span></div>
              <div class="text">Thanks Alice! That helps a lot.</div>
            </div>
            <div class="chat-message blue-message">
              <div class="author">
                Charlie <span class="time">10:20 AM</span>
              </div>
              <div class="text">
                I also uploaded the document you asked for.
              </div>
              <div class="attachments mt-1">
                <a href="#" class="btn btn-sm btn-outline-secondary"
                  >project-doc.pdf</a
                >
              </div>
            </div>
            <div class="chat-message blue-message">
              <div class="author">Alice <span class="time">10:22 AM</span></div>
              <div class="text">
                Perfect, let's review it in the next meeting.
              </div>
            </div>
            <!-- Add more mock messages to test scrolling -->
            <% for(let i=0; i<10; i++){ %>
            <div class="chat-message">
              <div class="author">
                User<%= i+1 %> <span class="time">10:<%= 25+i %> AM</span>
              </div>
              <div class="text">
                This is a sample message to test scrolling and layout.
              </div>
            </div>
            <% } %>
          </div>

          <!-- Input -->
          <div class="chat-input mt-auto p-2">
            <form class="d-flex gap-2" id="chatForm">
             <textarea id="message" name="message" rows="5" cols="50" placeholder="Type your message here..."></textarea>
              <input
                type="file"
                class="form-control form-control-sm"
                id="fileInput"
              />
              <button class="btn btn-primary">Send</button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <%- include('partials/footer') %>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
